<!--
 * @Author: zlc
 * @Date: 2022-02-15 22:13:51
 * @LastEditTime: 2022-02-15 22:39:56
 * @LastEditors: zlc
 * @Description: 
 * @FilePath: \gogogogo\project-template\案例\虚拟长列表\代码\js-实现虚拟长列表2.html
-->
<!DOCTYPE html>
<html lang="en">

	<head>
		<meta name="viewport" content="width=750, user-scalable=no, target-densitydpi=device-dpi">
		<script src="pubilc/js/mobileRem.js"></script>
		<link rel="stylesheet" type="text/css" href="pubilc/css/style.css" />
		<script src="pubilc/js/jquery.js"></script>
		<title></title>
	</head>
	<style>
		* {
			padding: 0;
			margin: 0;
			box-sizing: border-box;
		}

		#app {
			width: 7.5rem;
			height: 667px;
			background-color: antiquewhite;
		}

		.content {
			height: 5rem;
			/* overflow-y: auto; */
			
			overflow: hidden;
		}

		.item {
			text-align: center;
		}

		.infinite-list-container {
			height: 100%;
			overflow: auto;
			position: relative;
			-webkit-overflow-scrolling: touch;
		}
		.infinite-list-phantom {
		  position: absolute;
		  left: 0;
		  top: 0;
		  right: 0;
		  z-index:1;
		}
		
		.infinite-list {
		  left: 0;
		  right: 0;
		  top: 0;
		  position: absolute;
		  text-align: center;
		}
	</style>

	<body>

		<div id="app">
			<div class="content">
				<div class="infinite-list-container">
					<div class="infinite-list-phantom" :style="{ height: listHeight + 'px' }"></div>
					<div class="infinite-list">
						<!-- <div ref="items"
                        class="infinite-list-item" 
                        v-for="item in visibleData" 
                        :key="item.id"
                        :style="{ height: itemSize + 'px',lineHeight: itemSize + 'px' }"
                      >{{ item.value }}</div> -->
					</div>
					<div class="item item-box1" valign=top>
						<div>123456789</div>
						<div>123456789</div>
						<div>123456789</div>
						<div>123456789</div>
					</div>
					<div class="item item-box2" valign=top>
						<div>66623456789</div>
						<div>66623456789</div>
						<div>123456789</div>
						<div>123456789</div>
					</div>
					<div class="item item-box1" valign=top>
						<div>123456789</div>
						<div>123456789</div>
						<div>123456789</div>
						<div>123456789</div>
					</div>
					<div class="item item-box2" valign=top>
						<div>66623456789</div>
						<div>66623456789</div>
						<div>123456789</div>
						<div>123456789</div>
					</div>
				</div>
			</div>

		</div>

	</body>

</html>

<script>
	$(function() {
		var content = document.querySelector(".content")
		const windowWidth = document.documentElement.clientWidth
		const windowHeight = document.documentElement.clientHeight
		const itemSize = 60; //每一项的高度
		const listData = [];
		const visibleData=0
		const state = {
			start: "",
			end: "",
			startOffset: "",
			//可视区域高度
			screenHeight:0,
			visibleCount:0//可显示列表在视窗
		}
		console.log(state.screenHeight)
		//数据区域
		for (let i = 0; i < 100000; i++) {
			listData.push({
				id: i,
				value: i
			});
		}

		const listHeight = listData.length * itemSize; //列表总高度
		console.log(listData)
		$(".content").css('height', `${windowHeight}px`)
		$(".content").css('width', `${windowWidth}px`)
		//可显示的列表项数
		  
		$('.infinite-list-container').scroll(function(e) {
			let scrollTop=$(this)[0].scrollTop
			//此时的开始索引
			state.start = Math.floor(scrollTop /itemSize);
			state.end=state.start + state.visibleCount
			state.startOffset = scrollTop - (scrollTop % itemSize);
			$('.infinite-list').css('transform',`translate3d(0,${state.startOffset}px,0)`)
			getVisibleData()
			console.log(state.startOffset)
		})
		
		//获取每次可视区域能看到多少条数据
		function getVisibleCount(){
			state.visibleCount= Math.ceil(state.screenHeight / itemSize)
			console.log(state)
		}
		
		//页面渲染获取页面高度以及初始化索引计算位置
		function getIndexNumber(){
			state.screenHeight=document.documentElement.clientHeight
			state.start=0;
			state.end=state.start + Math.ceil(state.screenHeight / itemSize)
		}
		function getVisibleData(){
		
			visibleData=listData.slice(0, 14))
			console.log(Math.min(state.end,listData.length))
			console.log(listData.length)
			console.log(state.end)
			console.log(state.start)
		}
		
		
		
		$(function () {
		      $.each(visibleData, function (key, value) { //遍历这个数组，调用匿名函数进行处理
		        var link = $(`<div
                        class="infinite-list-item" 
                        :key="item.id"
                        :style="{ height: itemSize + 'px',lineHeight: itemSize + 'px' }"
                      >${value.id}/div>`); //创建一个节点
		        $(".infinite-list-item").append(link); //将这个节点加入到table中
		      })
		    })

		getIndexNumber();
		getVisibleCount();
		setTimeout(()=>{
			getVisibleData();
		},100)
		
	})
</script>
